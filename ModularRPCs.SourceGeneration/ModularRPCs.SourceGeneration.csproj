<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>

		<TargetFramework>netstandard2.0</TargetFramework>
		<LangVersion>preview</LangVersion>

    <!-- NOTE: I had to shorten the assembly name and namespaces because the generated file paths were too long for Windows to handle -->

		<RootNamespace>ModularRPCs</RootNamespace>
    <AssemblyTitle>ModularRPCs.SG</AssemblyTitle>
    <AssemblyName>$(AssemblyTitle)</AssemblyName>

    <PackageId>DanielWillett.ModularRpcs.SourceGeneration</PackageId>
    <Title>Modular RPCs Source Generation</Title>

    <PackageLicenseExpression>GPL-3.0-only</PackageLicenseExpression>
    <PackageProjectUrl>https://github.com/DanielWillett/ModularRPCs</PackageProjectUrl>
    <RepositoryUrl>$(PackageProjectUrl).git</RepositoryUrl>

		<Nullable>enable</Nullable>

    <Authors>Daniel Willett</Authors>
    <Company>$(Authors)</Company>

    <Version>1.0.0</Version>
		<PackageVersion>$(Version)-prerelease21</PackageVersion>

		<FileVersion>$(Version).0</FileVersion>
		<AssemblyVersion>$(Version).0</AssemblyVersion>

    <DevelopmentDependency>True</DevelopmentDependency>

    <PackageReadmeFile>README.md</PackageReadmeFile>

		<GeneratePackageOnBuild>true</GeneratePackageOnBuild>
		<IncludeBuildOutput>false</IncludeBuildOutput>
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>

    <IsRoslynComponent>true</IsRoslynComponent>
    <EnforceExtendedAnalyzerRules>true</EnforceExtendedAnalyzerRules>
    <NoWarn>NU5128</NoWarn>
	</PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.CodeAnalysis.CSharp" Version="4.14.0" PrivateAssets="all" />
    <PackageReference Include="Microsoft.CodeAnalysis.Analyzers" Version="4.14.0" PrivateAssets="all" />
  </ItemGroup>

  <ItemGroup>
    <!-- Generator dependencies -->
    <PackageReference Include="DanielWillett.ModularRPCs" Version="[1.0.0-prerelease20, 2.0.0)" GeneratePathProperty="true" />
  </ItemGroup>
	
  <PropertyGroup>
    <GetTargetPathDependsOn>$(GetTargetPathDependsOn);GetDependencyTargetPaths</GetTargetPathDependsOn>
  </PropertyGroup>

  <Target Name="GetDependencyTargetPaths">
    <ItemGroup>
      <TargetPathWithTargetPlatformMoniker Include="$(PKGDanielWillett_ModularRPCs)\lib\netstandard2.0\*.dll" IncludeRuntimeDependency="false" />
    </ItemGroup>
  </Target>

	<ItemGroup>

    <Compile Remove="build/**" />
    <EmbeddedResource Remove="build/**" />
    <None Remove="build/**" />

    <None Include="$(OutputPath)\$(AssemblyName).dll" Pack="true" PackagePath="analyzers/dotnet/cs" Visible="false" />
    <None Include="$(SolutionDir)\README.md" Pack="true" PackagePath="/" />
    <None Include="build\DanielWillett.ModularRpcs.SourceGeneration.props" Pack="true" PackagePath="buildTransitive" />
    <None Include="$(PKGDanielWillett_ModularRPCs)\lib\netstandard2.0\*.dll" Pack="true" PackagePath="analyzers/dotnet/cs" />

  </ItemGroup>

</Project>
